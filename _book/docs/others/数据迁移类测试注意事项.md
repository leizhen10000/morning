# 7.1 数据迁移类测试注意事项

###1、老表和新表之间的关系要搞清楚
>a 是从老表迁移到新表，表结构完全一致？老表拆成多张新表？多张老表合并到一张新表？  
>b 无论是那种形式，新表和老表的对应各字段的对应关系都要完全搞清楚  
>c 除了字段对应之外，字段定义的类型以及长度都要检查下，是否是一致的或者是兼容的 

###2、老数据对应的上游业务要搞清楚
>a 了解下有多少服务或者多少应用会去查这张表中的数据？  
>b  确认下有操作这张表对应的服务是否都会接到新表上，或者是已废弃  

###3、如果数据量大的话，如果处理要搞清楚
>a 是否要考虑分库分表  
>b 是否要考虑历史归档表，如果有，放入历史归档表的规则是什么  

###3、迁移全过程测试  
####3.1数据层面比对  
>a 老数据是否都按字段的对应关系迁移到新表上  
>b 迁移的数据量是否有多迁移或少迁移  
>c SQL脚本的检查  
>d 注：尤其是除了单纯的新老表对应关系之外，还有其他规则，比如老数据中的重复数据，去从迁移；比如老数据中的某个字段为某各值的时候视为垃圾数据；日期的转化；空值的判断等等  

####3.2业务层测试-迁移前
>根据业务实际情况，设计一批老数据，作为迁移前的数据老数据准备  

####3.3业务层测试-迁移中
>迁移过程中因为还是不断的有新数据写入，这个迁移过程中会采用什么样的迁移方式？这个需要考虑到，和开发沟通清楚  
>a 是停机迁移？  
>b 不停机，是新老服务并存，双写？  
>c 不停机，是老服务直接下掉，直接上新服务？  
>---------不同的类型要考虑不同的问题，尤其是双写的话，这些重复重复写入的数据会如何比对并可能需要再次迁移到新表中  

>其他存储机制有没有变，比如从mysql改成存manggo或者ES等等，如果有，则还要考虑不同的数据存储对象的特性可能会有什么新的问题产生  

####3.4 业务层测试-迁移后
>a 数据层面的测试参考3.1  
>b 之前准备的老数据根据之前数据设计的场景，用老数据进行测试  
>c 新的业务操作对应的新数据写入是否正确  
